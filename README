This is a set of tools for log scanning and blacklist management.

It uses a slightly modified version of logsurfer for log scanning and
blacklistd to maintain a blacklist.

The original Logsurfer is available from:

https://www.crypt.gen.nz/logsurfer/

The locally modified version is in the git repository at 

git@git.entrain.nz:/logsurfer

Configuration needs to be refactored. Currently, it is in both
/usr/local/etc and /etc, which is silly.

One instance of logsurfer is run for each log file to be scanned. Each has
its own configuration file, with patterns (regular expressions) to identify
addresses to be added to the blacklist or a separately maintained whitelist.
These patterns are very simple - matching single lines, at the moment.

The whitelist isn't referenced in iptables but an address on the whitelist
will never be added to the blacklist. Addresses from trusted networks from
which access is required should be added to whitelist. This will happen
automatically after successful ssh login or SENDING email.

Current configuration / scanning rules are from a system running
Armbian as a server hosting websites, git and npm repositories and providing
email service, accessible via ssh (headless server). There is configuration
for scanning auth.log, mail.log and nginx/access.log. It is just a start.


Installation:

Put the contents if bin into /usr/local/bin

Put conf/blacklistd.conf in /etc/blacklist

Put logsurfer (and its contents) in /usr/local/etc

Put the contents of systemd into /etc/systemd/system and enable each.

Put iptablesload in /etc/network/if-pre-up.d


Near the top of the iptables INPUT chain, add something like:

-A INPUT -m set --match-set blacklist2 src -j LOG_DROP
